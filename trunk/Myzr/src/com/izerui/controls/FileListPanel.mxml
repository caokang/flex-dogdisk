<?xml version="1.0" encoding="utf-8"?>
<mx:Panel xmlns:fx="http://ns.adobe.com/mxml/2009" 
		 xmlns:s="library://ns.adobe.com/flex/spark" 
		 xmlns:mx="library://ns.adobe.com/flex/mx"
		 title="{resourceManager.getString('jhaij','filegrid_title')}" titleIcon="@Embed('assets/img/billing.png')" creationComplete="panel1_creationCompleteHandler(event)">
	
	<fx:Script>
		<![CDATA[
			import com.adobe.cairngorm.control.CairngormEventDispatcher;
			import com.izerui.cairngorm.event.ListFilesByFolderClassEvent;
			import com.izerui.components.loading.LoaderManager;
			import com.izerui.event.I18nEvent;
			import com.izerui.vo.FileItem;
			import com.izerui.vo.FileTree;
			
			import mx.collections.ArrayCollection;
			import mx.collections.Sort;
			import mx.collections.SortField;
			import mx.controls.Alert;
			import mx.events.FlexEvent;
			import mx.events.ListEvent;
			import mx.formatters.DateFormatter;
			
			private var currentPath:String;
			
			public function loadFiles(treeItem:FileTree):void
			{
				CairngormEventDispatcher.getInstance().dispatchEvent(new ListFilesByFolderClassEvent(treeItem.folderpath,listFileResponse));
				LoaderManager.showLoading(false);
				function listFileResponse(data:ArrayCollection):void{
					LoaderManager.hideLoading();
					data.sort = new Sort;
					data.sort.fields =  [new SortField("isfolder",true,true)]; 
					data.refresh();
					myFileGrid.dataProvider = data;
					currentPath = treeItem.folderpath;//保存当前path路径
				}
			}
			
			
			protected function myFileGrid_itemDoubleClickHandler(event:ListEvent):void
			{
				// TODO Auto-generated method stub
				if(myFileGrid.selectedItem.isfolder){
					var imitationTreeVo:FileTree = new FileTree;
					imitationTreeVo.foldername = myFileGrid.selectedItem.filename;
					imitationTreeVo.folderpath = myFileGrid.selectedItem.folderpath;
					this.loadFiles(imitationTreeVo);
				}
			}
			
			private function formatDate(item:Object,column:DataGridColumn):String{
				var df:DateFormatter = new DateFormatter();
				df.formatString = "YYYY-MM-DD HH:NN:SS";
				return df.format(item[column.dataField]);// df是一个DateFormatter，这里格式化item数据中的startDate字段
			}
			
			protected function panel1_creationCompleteHandler(event:FlexEvent):void
			{
				resourceManager.addEventListener(I18nEvent.I18NRESOURCECHANGE,i18nResourceChange);
				
			}
			
			private function i18nResourceChange(event:I18nEvent):void
			{
				(linkButtonBar.dataProvider as ArrayCollection).refresh();
			}
			
		]]>
	</fx:Script>
	
	<fx:Declarations>
		<!-- 将非可视元素（例如服务、值对象）放在此处 -->
	</fx:Declarations>
	<mx:DataGrid id="myFileGrid" width="100%" height="100%" allowMultipleSelection="true" itemDoubleClick="myFileGrid_itemDoubleClickHandler(event)" doubleClickEnabled="true">
		<mx:columns>
				<mx:DataGridColumn  itemRenderer="com.izerui.controls.itemRender.FolderIconRender" dataField="filename" headerText="{resourceManager.getString('jhaij','filegrid_name_header')}"/>
				<mx:DataGridColumn width="150"  dataField="size" headerText="{resourceManager.getString('jhaij','filegrid_size_header')}"/>
				<mx:DataGridColumn width="250"  dataField="lashmodifydate" labelFunction="formatDate" headerText="{resourceManager.getString('jhaij','filegrid_lashmodifydate_header')}"/>
		</mx:columns>
	</mx:DataGrid>
	<mx:ControlBar>
		<mx:LinkBar id="linkButtonBar">
			<mx:dataProvider>
				<s:ArrayCollection>
					<fx:Object label="{resourceManager.getString('jhaij','linkbar_button1_label')}"/>
					<fx:Object label="{resourceManager.getString('jhaij','linkbar_button2_label')}"/>
					<fx:Object label="{resourceManager.getString('jhaij','linkbar_button3_label')}"/>
					<fx:Object label="{resourceManager.getString('jhaij','linkbar_button4_label')}"/>
					<fx:Object label="{resourceManager.getString('jhaij','linkbar_button5_label')}"/>
					<fx:Object label="{resourceManager.getString('jhaij','linkbar_button6_label')}"/>
				</s:ArrayCollection>
			</mx:dataProvider>
		</mx:LinkBar>
	</mx:ControlBar>
</mx:Panel>
